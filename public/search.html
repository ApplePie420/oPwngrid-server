<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>




        <script>
        function formatTimestamp(date) {
            let hours = date.getHours().toString().padStart(2, "0");
            let minutes = date.getMinutes().toString().padStart(2, "0");
            let day = date.getDate();
            let month = date.toLocaleString('default', { month: 'long' });
            let year = date.getFullYear();
            let dayOfWeek = date.toLocaleString('default', { weekday: 'long' });
            let timezoneAbbreviation = date.toLocaleString('default', { timeZoneName: 'short' });
  
            return hours + ":" + minutes + " " + dayOfWeek + " " + day + " " + month + " " + year + " " + timezoneAbbreviation;
            }
            
            $(document).ready(function() {
                $.get(`https://api.opwngrid.xyz/api/v1/search/${window.location.pathname.split("/search/")[1]}`, function(data) {
                if (!data.error) {
                    data = JSON.parse(data)
                    data.data = JSON.parse(data.data)
                    document.getElementById("userStringName").innerText=`${data.name}`;

                    let dateCreated = new Date(data.created_at);
                    let dateUpdated = new Date(data.updated_at);

                    let userTimezoneOffset = timestamp.getTimezoneOffset();

                    let userDateCreated = new Date(dateCreated.getTime() - userTimezoneOffset * 60000);
                    let userDateUpdated = new Date(dateUpdated.getTime() - userTimezoneOffset * 60000);



                    if (data.updated_at) {
                        document.getElementById("userString").innerText=`Unit ${data.name} registered ${formatTimestamp(userDateCreated)} and has been seen online ${data.updated_at} from ${data.country}. It reported ${data.data.advertisement.pwnd_tot} pwned networks so far.`;
                    } else {
                        document.getElementById("userString").innerText=`Unit ${data.name} registered ${formatTimestamp(userDateCreated)} from ${formatTimestamp(userDateUpdated)}. It reported ${data.data.advertisement.pwnd_tot} pwned networks so far.`;

                    }

                } else {
                    document.getElementById("userStringName").innerText=`Unit doesnt exist`;
                }
            });
        });
        </script>
    </head>
    <body style="font-family: Roboto;">
        <h1>Search for a Device</h1>
        <h2><a href="../">home</a>   <a href="/convert">convert</a>  search</h2>
        <form id="search-form">
            <input type="text" id="search-input" placeholder="Search...">
            <button type="button" id="search-button">Search</button>
        </form>
        <h1 id="userStringName"></h1>
        <h3 id="userString"></h3>
        <script>
            // Get references to the input and button elements
            const searchInput = document.getElementById('search-input');
            const searchButton = document.getElementById('search-button');
    
            // Add a click event listener to the button
            searchButton.addEventListener('click', function () {
                // Get the text from the input
                const searchText = searchInput.value.trim();
    
                // Check if the input is not empty
                if (searchText) {
                    // Redirect to /search/ with the search query appended
                    window.location.href = `/search/${encodeURIComponent(searchText)}`;
                }
            });
            </script>
    </body>


</html>